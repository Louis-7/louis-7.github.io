import"./modulepreload-polyfill-B5Qt9EMX.js";const h=document.getElementById("gameCanvas"),t=h.getContext("2d"),D=document.getElementById("loading-animals-canvas"),A=D.getContext("2d"),E=document.getElementById("interaction-prompt"),L=document.getElementById("modal-overlay"),se=document.getElementById("modal-body"),ae=document.getElementById("close-btn");let Y,g,m,M,C,$,J;const re=`
<div id="settings-panel">
    <div class="panel-header" id="panel-header">
        <span>‚öôÔ∏è MENU</span>
        <span id="toggle-icon">‚ñº</span>
    </div>
    <div class="panel-body">
        <div class="control-group">
            <span class="control-label">Current Season</span>
            <button class="pixel-btn" id="season-btn">SPRING</button>
        </div>
        <div class="control-group">
            <span class="control-label">Map Editor</span>
            <button class="pixel-btn" id="editor-toggle-btn">Enable Editing</button>
            <div id="editor-tools">
                <button class="tool-btn active" onclick="setTool('tree')">üå≤</button>
                <button class="tool-btn" onclick="setTool('rock')">ü™®</button>
                <button class="tool-btn" onclick="setTool('flower')">üå∏</button>
                <button class="tool-btn" onclick="setTool('plant')">üåø</button>
                <button class="tool-btn" onclick="setTool('cow')">üêÑ</button>
                <button class="tool-btn" onclick="setTool('chicken')">üêî</button>
                <button class="tool-btn" onclick="setTool('horse')">üêé</button>
                <button class="tool-btn" onclick="setTool('sheep')">üêè</button>
                <button class="tool-btn" onclick="setTool('erase')">‚ùå</button>
            </div>
        </div>
        <div class="control-group">
            <button class="pixel-btn" onclick="exportMap()" style="font-size: 8px;">üíæ Copy Map JSON</button>
        </div>
        <div class="control-group">
            <span class="control-label">Debug</span>
            <button class="pixel-btn" id="debug-toggle-btn">Show Coords</button>
        </div>
    </div>
</div>`;window.openSesame=function(){if(document.getElementById("settings-panel"))return;const e=document.getElementById("ui-layer"),l=document.getElementById("interaction-prompt"),i=document.createElement("div");i.innerHTML=re,e.insertBefore(i.firstElementChild,l),Y=document.getElementById("settings-panel"),g=document.getElementById("season-btn"),m=document.getElementById("editor-toggle-btn"),M=document.getElementById("debug-toggle-btn"),C=document.getElementById("editor-tools"),$=document.getElementById("panel-header"),J=document.getElementById("toggle-icon"),ye(),g&&(g.innerText=_[s.season.current]),console.log("Developer Mode Enabled")};const x=4,R=32,ce=6e4,_=["Spring","Summer","Fall","Winter"],c={minX:-800,maxX:800,minY:-600,maxY:600},v=.5,q={cow:{body:"#e3dac9",spots:"#5d4037",snout:"#f8bbd0"},chicken:{body:"#ffffff",comb:"#c0392b",beak:"#f1c40f"},horse:{body:"#a1887f",mane:"#5d4037",snout:"#d7ccc8"},sheep:{body:"#ecf0f1",head:"#34495e",legs:"#34495e"}},V={Spring:{grass:"#76c758",grassDark:"#66b04a",dirt:"#8b5e3c",wood:"#a05a2c",woodDark:"#6d3d1e",roof:"#c0392b",water:"#3498db",treeLight:"#2ecc71",treeDark:"#27ae60",flowerStem:"#27ae60",flowerPetal:"#e74c3c",cropLeaf:"#2ecc71",cropFruit:["#e74c3c","#f1c40f","#9b59b6"]},Summer:{grass:"#53c738",grassDark:"#41a02a",dirt:"#8b5e3c",wood:"#a05a2c",woodDark:"#6d3d1e",roof:"#c0392b",water:"#3498db",treeLight:"#2ecc71",treeDark:"#27ae60",flowerStem:"#27ae60",flowerPetal:"#f39c12",cropLeaf:"#27ae60",cropFruit:["#c0392b","#e67e22","#f39c12"]},Fall:{grass:"#d68910",grassDark:"#b9770e",dirt:"#6e4c30",wood:"#a05a2c",woodDark:"#6d3d1e",roof:"#922b21",water:"#2e86c1",treeLight:"#e67e22",treeDark:"#d35400",flowerStem:"#8b5e3c",flowerPetal:"#8e44ad",cropLeaf:"#d35400",cropFruit:["#e67e22","#8e44ad","#c0392b"]},Winter:{grass:"#ecf0f1",grassDark:"#bdc3c7",dirt:"#95a5a6",wood:"#7f8c8d",woodDark:"#555",roof:"#2c3e50",water:"#aed6f1",treeLight:"#dfe6e9",treeDark:"#b2babb",flowerStem:"#95a5a6",flowerPetal:"#3498db",cropLeaf:"#bdc3c7",cropFruit:["#ecf0f1","#95a5a6","#7f8c8d"]}};let d={...V.Spring},s={player:{x:0,y:0,w:R,h:R,dir:"down",isMoving:!1},keys:{w:!1,a:!1,s:!1,d:!1,ArrowUp:!1,ArrowLeft:!1,ArrowDown:!1,ArrowRight:!1," ":!1,Enter:!1},camera:{x:0,y:0},interactionTarget:null,isModalOpen:!1,lastTime:0,season:{current:0,timer:0},editor:{active:!1,tool:"tree",mouseX:0,mouseY:0},debug:{showCoords:!1}};const w=[{id:"house",x:-80,y:-300,w:160,h:140,type:"building",label:"My House",interactDist:60,collisionBox:{x:10,y:40,w:140,h:90},door:{x:70,y:130},content:`
            <h2>About Me</h2>
            <p>Hi! I'm <strong>Louis</strong>, I'm a full-stack web developer with a strong focus on web technologies.</p>
            <h3>Skills</h3>
            <ul>
                <li>JavaScript, TypeScript (React, Node.js, Angular, Backbone, ...)</li>
                <li>Ruby on Rails</li>
                <li>HTML, CSS</li>
                <li>Database Design (SQL, NoSQL)</li>
                <li>Cloud platform (AWS)</li>
            </ul>
        `},{id:"field1",x:100,y:0,w:150,h:150,type:"garden",label:"Projects Field",interactDist:80,collisionBox:{x:0,y:0,w:150,h:150},door:{x:75,y:150},content:`
            <h2>Projects Field</h2>
            <p>Here is what I've been growing lately:</p>

            <h3>
                <a href="https://github.com/Snap-Mind/snap-mind" target="_blank" style="color: #d35400; text-decoration: none;">üß† SnapMind</a>
            </h3>
            <p>A cross-platform desktop AI assistant that lets you translate, rewrite, summarize, and brainstorm with just a hotkey.</p>

            <h3>üß¨ Cytobank</h3>
            <p>A cloud-based Flow Cytometry data analysis platform.</p>

            <h3>üîÅ Aldon Lifecycle Management</h3>
            <p>A Software Life Management tool on IBM i.</p>

            <h3>üßë‚Äçüíª Zowe Code Editor</h3>
            <p>A plug-in of Zowe running on IBM mainframe.</p>
        `},{id:"board",x:-250,y:-210,w:80,h:60,type:"sign",label:"Blog Board",interactDist:50,collisionBox:{x:10,y:10,w:60,h:50},door:{x:40,y:65},content:`
            <h2>Community Board (Blog)</h2>

            <h3>üìÖ Fetching</h3>
            <p>Loading my blogs...</p>
        `},{id:"mailbox",x:130,y:-210,w:30,h:50,type:"mailbox",label:"Resume/Contact",interactDist:40,collisionBox:{x:0,y:0,w:30,h:50},door:{x:15,y:55},content:`
            <h2>Contact Me</h2>
            <p><strong>Email:</strong> <a href="mailto:louisgh.cn@gmail.com" style="color: #d35400;">louisgh.cn@gmail.com</a></p>
            <hr>
            <h3>Social Medias</h3>
            <p><strong>GitHub:</strong> <a href="https://github.com/louis-7" target="_blank" style="color: #d35400;">github.com/louis-7</a></p>
            <p><strong>Dev.to:</strong> <a href="https://dev.to/louis7" target="_blank" style="color: #d35400;">dev.to/louis7</a></p>
            <p><strong>LinkedIn:</strong> <a href="https://www.linkedin.com/in/louis360" target="_blank" style="color: #d35400;">linkedin.com/in/louis360</a></p>
        `}];let p=[],u=[],G=[];function Q(e,l,i){u.push({x:l,y:i,type:e,dir:"down",facing:e==="chicken"?"right":"left",frame:0,isMoving:!1,moveTimer:Math.random()*2e3})}function fe(){p=[],u=[],G=[],["cow","cow","chicken","chicken","chicken","horse","sheep","sheep"].forEach(l=>{let i=!1,o=0;for(;!i&&o<50;){let n,a;o<20?(n=150+Math.random()*400,a=-200+Math.random()*400):(n=Math.random()*(c.maxX-c.minX)+c.minX,a=Math.random()*(c.maxY-c.minY)+c.minY);let r=!1;const y=40;for(const f of w)if(n>f.x-y&&n<f.x+f.w+y&&a>f.y-y&&a<f.y+f.h+y){r=!0;break}r||(Q(l,n,a),i=!0),o++}});for(let l=0;l<100;l++){const i=Math.random()*(c.maxX-c.minX)+c.minX,o=Math.random()*(c.maxY-c.minY)+c.minY;let n=!1;const a=30;for(const r of w)if(i>r.x-a&&i<r.x+r.w+a&&o>r.y-a&&o<r.y+r.h+a){n=!0;break}i>130&&i<570&&o>-220&&o<320&&(n=!0),!n&&p.push({x:i,y:o,type:Math.random()>.7?"rock":"tree"})}p.push({x:-150,y:-250,type:"tree"}),p.push({x:80,y:-250,type:"tree"}),p.push({x:-400,y:-200,type:"rock"})}function K(){s.season.current=(s.season.current+1)%_.length,s.season.timer=0,de()}function de(){const e=_[s.season.current];d={...V[e]},g&&(g.innerText=e),console.log("Season changed to "+e)}function ye(){g&&g.addEventListener("click",K),$.addEventListener("click",()=>{Y.classList.toggle("minimized"),J.innerText=Y.classList.contains("minimized")?"‚ñ∂":"‚ñº"}),m.addEventListener("click",()=>{s.editor.active=!s.editor.active,s.editor.active?(m.innerText="Disable Editing",m.classList.add("active"),C.style.display="grid"):(m.innerText="Enable Editing",m.classList.remove("active"),C.style.display="none")}),M.addEventListener("click",()=>{s.debug.showCoords=!s.debug.showCoords,M.classList.toggle("active"),M.innerText=s.debug.showCoords?"Hide Coords":"Show Coords"})}window.setTool=function(e){s.editor.tool=e,document.querySelectorAll("#editor-tools .tool-btn").forEach(l=>{l.outerHTML.includes(e)?l.classList.add("active"):l.classList.remove("active")})};window.exportMap=function(){const e=JSON.stringify({scenery:p,animals:u});navigator.clipboard.writeText(e).then(()=>{alert("Map data copied to clipboard! You can save this JSON.")}),console.log(e)};h.addEventListener("mousemove",e=>{const l=h.getBoundingClientRect();s.editor.mouseX=e.clientX-l.left,s.editor.mouseY=e.clientY-l.top});h.addEventListener("mousedown",e=>{if(!s.editor.active)return;const l=h.getBoundingClientRect(),i=e.clientX-l.left,o=e.clientY-l.top,n=Math.round(i+s.camera.x),a=Math.round(o+s.camera.y),r=30;if(s.editor.tool==="erase"){let y=p.findIndex(f=>Math.hypot(f.x-n,f.y-a)<r);y!==-1?p.splice(y,1):(y=u.findIndex(f=>Math.hypot(f.x-n,f.y-a)<r),y!==-1&&u.splice(y,1))}else["cow","chicken","horse","sheep"].includes(s.editor.tool)?Q(s.editor.tool,n,a):p.push({x:n,y:a,type:s.editor.tool})});window.addEventListener("keydown",e=>{if((s.keys.hasOwnProperty(e.key)||e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&(s.keys[e.key]=!0),(e.key==="Escape"||e.key===" ")&&s.isModalOpen){P();return}(e.key===" "||e.key==="Enter")&&!s.isModalOpen&&s.interactionTarget&&oe(s.interactionTarget.content)});window.addEventListener("keyup",e=>{(s.keys.hasOwnProperty(e.key)||e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")&&(s.keys[e.key]=!1)});const k=document.getElementById("joystick"),j=document.getElementById("joystick-knob"),he=document.getElementById("btn-action"),pe=document.getElementById("btn-close"),X=document.getElementById("mobile-controls"),O=document.getElementById("mobile-interaction-prompt");function S(){if(!window.visualViewport){X.style.bottom="20px";return}const e=window.visualViewport,l=window.innerHeight-(e.offsetTop+e.height),i=Math.max(20,l+100);X.style.bottom=`${i}px`}const z="ontouchstart"in window||navigator.maxTouchPoints>0;z&&(X.style.display="block",E.style.display="none",S(),window.visualViewport&&(window.visualViewport.addEventListener("resize",S),window.visualViewport.addEventListener("scroll",S)),window.addEventListener("resize",S),window.addEventListener("orientationchange",()=>{setTimeout(S,100)}));let F=!1,I={x:0,y:0};const B=35;function ee(e,l){const i=k.getBoundingClientRect();I={x:i.left+i.width/2,y:i.top+i.height/2};let o=e-I.x,n=l-I.y;const a=Math.sqrt(o*o+n*n);a>B&&(o=o/a*B,n=n/a*B),j.style.transform=`translate(calc(-50% + ${o}px), calc(-50% + ${n}px))`,s.keys.ArrowUp=!1,s.keys.ArrowDown=!1,s.keys.ArrowLeft=!1,s.keys.ArrowRight=!1;const r=15;a>r&&(n<-r*.5&&(s.keys.ArrowUp=!0),n>r*.5&&(s.keys.ArrowDown=!0),o<-r*.5&&(s.keys.ArrowLeft=!0),o>r*.5&&(s.keys.ArrowRight=!0))}function te(){F=!1,j.style.transform="translate(-50%, -50%)",s.keys.ArrowUp=!1,s.keys.ArrowDown=!1,s.keys.ArrowLeft=!1,s.keys.ArrowRight=!1}k.addEventListener("touchstart",e=>{e.preventDefault(),F=!0;const l=e.touches[0];ee(l.clientX,l.clientY)});k.addEventListener("touchmove",e=>{if(e.preventDefault(),F){const l=e.touches[0];ee(l.clientX,l.clientY)}});k.addEventListener("touchend",e=>{e.preventDefault(),te()});k.addEventListener("touchcancel",e=>{e.preventDefault(),te()});he.addEventListener("touchstart",e=>{e.preventDefault(),!s.isModalOpen&&s.interactionTarget&&oe(s.interactionTarget.content)});pe.addEventListener("touchstart",e=>{e.preventDefault(),s.isModalOpen&&P()});async function ge(){const e=w.find(l=>l.id==="board");if(e){e.content="<h2>Community Board (Blog)</h2><p>Loading articles...</p>";try{const i=await(await fetch("https://dev.to/api/articles?username=louis7")).json();let o="<h2>Community Board (Blog)</h2>";i.forEach(n=>{const a=new Date(n.published_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});o+=`
                <div class="blog-item" style="margin-bottom: 20px; border-bottom: 1px dashed #8b4513; padding-bottom: 10px;">
                    <h3 style="margin-bottom: 8px; font-size: 14px;">
                        <a href="${n.url}" target="_blank" style="color: #d35400; text-decoration: none;">${n.title}</a>
                    </h3>
                    <p style="font-size: 10px; color: #555; margin: 0;">
                        ‚è≥ ${n.reading_time_minutes} min ¬∑ üìÖ ${a} ¬∑ ‚ù§Ô∏è ${n.public_reactions_count}
                    </p>
                </div>
            `}),e.content=o}catch(l){console.error(l),e.content=`
            <h2>Community Board (Blog)</h2>
            <p>Failed to load blogs.</p>
            <p>Check out <a href="https://dev.to/louis7" target="_blank">dev.to/louis7</a></p>
        `}}}const le=[{type:"cow",x:50,baseY:60,y:60,direction:"right",frame:0,bounceOffset:0},{type:"chicken",x:110,baseY:60,y:60,direction:"right",frame:0,bounceOffset:Math.PI/2},{type:"horse",x:180,baseY:60,y:60,direction:"right",frame:0,bounceOffset:Math.PI},{type:"sheep",x:250,baseY:60,y:60,direction:"right",frame:0,bounceOffset:Math.PI*1.5}];function ue(e,l){const i=l.x,o=l.y,n=q[l.type],a=Math.floor(l.frame)===1?2:0;e.save(),l.direction==="left"&&(e.translate(i,o),e.scale(-1,1),e.translate(-i,-o)),e.fillStyle="rgba(0,0,0,0.2)",e.beginPath(),e.ellipse(i,o+4,10,5,0,0,Math.PI*2),e.fill(),l.type==="cow"?(e.fillStyle=n.body,e.fillRect(i-14,o-20,28,20),e.fillStyle=n.spots,e.fillRect(i-8,o-18,10,8),e.fillRect(i+6,o-14,6,6),e.fillStyle=n.body,e.fillRect(i-18,o-26,16,16),e.fillStyle="#d7ccc8",e.fillRect(i-18,o-28,4,4),e.fillRect(i-6,o-28,4,4),e.fillStyle=n.body,e.fillRect(i-20,o-22,2,4),e.fillRect(i-2,o-22,2,4),e.fillStyle=n.snout,e.fillRect(i-18,o-14,16,6),e.fillStyle="#000",e.fillRect(i-16,o-20,2,2),e.fillRect(i-8,o-20,2,2),e.fillStyle=n.body,e.fillRect(i-12,o,6,6+a),e.fillRect(i+6,o,6,6-a),e.fillStyle=n.body,e.fillRect(i+14,o-18,2,10),e.fillStyle=n.spots,e.fillRect(i+13,o-8,4,4)):l.type==="chicken"?(e.fillStyle=n.body,e.fillRect(i-6,o-10,12,10),e.fillStyle=n.body,e.fillRect(i-8,o-12,4,6),e.fillStyle="#e0e0e0",e.fillRect(i-2,o-8,6,4),e.fillStyle=n.body,e.fillRect(i+2,o-14,6,6),e.fillStyle=n.comb,e.fillRect(i+3,o-15,4,2),e.fillStyle=n.beak,e.fillRect(i+8,o-11,2,2),e.fillStyle="#000",e.fillRect(i+4,o-13,2,1),e.fillStyle="#8b6f47",e.fillRect(i-2,o,2,2+a),e.fillRect(i+4,o,2,2-a)):l.type==="horse"?(e.fillStyle=n.body,e.fillRect(i-12,o-18,24,18),e.fillStyle=n.body,e.fillRect(i-16,o-24,12,12),e.fillStyle=n.mane,e.fillRect(i-14,o-26,2,4),e.fillRect(i-10,o-26,2,4),e.fillStyle=n.snout,e.fillRect(i-18,o-20,4,4),e.fillStyle="#000",e.fillRect(i-12,o-22,2,2),e.fillStyle=n.mane,e.fillRect(i+12,o-10,2,10),e.fillStyle=n.body,e.fillRect(i-8,o,4,5+a),e.fillRect(i+4,o,4,5-a)):l.type==="sheep"&&(e.fillStyle=n.body,e.fillRect(i-12,o-16,24,14),e.fillRect(i-14,o-12,28,6),e.fillStyle=n.head,e.fillRect(i-8,o-20,16,10),e.fillStyle="#000",e.fillRect(i-4,o-18,2,2),e.fillRect(i+4,o-18,2,2),e.fillStyle=n.head,e.fillRect(i-10,o-22,2,3),e.fillRect(i+8,o-22,2,3),e.fillStyle=n.legs,e.fillRect(i-8,o,3,5+a),e.fillRect(i-2,o,3,5-a),e.fillRect(i+4,o,3,5+a)),e.restore()}function me(e){le.forEach(l=>{l.bounceOffset+=e*.005;const i=Math.sin(l.bounceOffset)*3;l.y=l.baseY+i,l.frame=(l.frame+e*.01)%2})}function we(){A.fillStyle="#2c3e50",A.fillRect(0,0,D.width,D.height),le.forEach(e=>{ue(A,e)})}let T=null,N=Date.now();function be(){function e(){const l=Date.now(),i=l-N;N=l,me(i),we(),T=requestAnimationFrame(e)}e()}function Se(){T!==null&&(cancelAnimationFrame(T),T=null)}async function Re(){H(),window.addEventListener("resize",H),fe(),be();const e=new Promise(r=>setTimeout(r,2e3)),l=new Promise(r=>setTimeout(r,5e3)),i=document.fonts.ready.catch(r=>console.warn("Font load warning:",r)),o=ge().catch(r=>console.warn("Blog load warning:",r)),n=Promise.all([i,o]);await Promise.all([e,Promise.race([n,l])]),Se(),s.player.x=0,s.player.y=-150;const a=document.getElementById("loading-screen");a.classList.add("fade-out"),requestAnimationFrame(ne),setTimeout(()=>{a.style.display="none"},1e3)}function H(){h.width=window.innerWidth,h.height=window.innerHeight,t.imageSmoothingEnabled=!1}function ke(e){if(s.isModalOpen)return;s.season.timer+=e,s.season.timer>=ce&&K(),u.forEach(n=>{if(n.moveTimer-=e,n.isMoving)if(n.moveTimer<=0)n.isMoving=!1,n.frame=0,n.moveTimer=1e3+Math.random()*2e3;else{let a=0,r=0;n.dir==="up"&&(r=-v),n.dir==="down"&&(r=v),n.dir==="left"&&(a=-v,n.facing="left"),n.dir==="right"&&(a=v,n.facing="right");let y=n.x+a,f=n.y+r;if((y<c.minX+20||y>c.maxX-20)&&(y=n.x),(f<c.minY+20||f>c.maxY-20)&&(f=n.y),ie({x:y-10,y:f-5,w:20,h:10})){y=n.x,f=n.y;const b=["up","down","left","right"];n.dir=b[Math.floor(Math.random()*b.length)]}n.x=y,n.y=f,n.frame=(n.frame+e*.01)%2}else if(n.moveTimer<=0){n.isMoving=!0,n.moveTimer=2e3+Math.random()*3e3;const a=["up","down","left","right"];n.dir=a[Math.floor(Math.random()*a.length)]}});const l=s.player;let i=0,o=0;if((s.keys.w||s.keys.ArrowUp)&&(o=-x),(s.keys.s||s.keys.ArrowDown)&&(o=x),(s.keys.a||s.keys.ArrowLeft)&&(i=-x),(s.keys.d||s.keys.ArrowRight)&&(i=x),i!==0&&o!==0&&(i*=.707,o*=.707),i!==0||o!==0){l.isMoving=!0,Math.abs(i)>Math.abs(o)?l.dir=i>0?"right":"left":l.dir=o>0?"down":"up";let n=l.x+i,a=l.y+o;n<c.minX&&(n=l.x),n>c.maxX-l.w&&(n=l.x),a<c.minY&&(a=l.y),a>c.maxY-l.h&&(a=l.y),U(n,l.y)||(l.x=n),U(l.x,a)||(l.y=a)}else l.isMoving=!1;xe(),s.camera.x=l.x-h.width/2+l.w/2,s.camera.y=l.y-h.height/2+l.h/2}function ie(e){for(let l of w){const i=l.collisionBox,o=l.x+i.x,n=l.y+i.y;if(e.x<o+i.w&&e.x+e.w>o&&e.y<n+i.h&&e.y+e.h>n)return!0}return!1}function U(e,l){const i={x:e,y:l+R/2,w:R,h:R/2};return ie(i)}function xe(){const e=s.player,l={x:e.x+e.w/2,y:e.y+e.h/2};let i=null,o=1/0;for(let n of w){const a={x:n.x+n.door.x,y:n.y+n.door.y},r=Math.hypot(l.x-a.x,l.y-a.y);r<n.interactDist&&r<o&&(o=r,i=n)}s.interactionTarget=i,i?z?O.style.display="block":E.style.display="block":(E.style.display="none",O.style.display="none")}function oe(e){s.isModalOpen=!0,se.innerHTML=e,L.style.display="flex",E.style.display="none",O.style.display="none",Object.keys(s.keys).forEach(l=>s.keys[l]=!1)}function P(){s.isModalOpen=!1,L.style.display="none"}ae.addEventListener("click",P);L.addEventListener("click",e=>{e.target===L&&P()});function ve(){t.fillStyle="#111",t.fillRect(0,0,h.width,h.height),t.save(),t.translate(-s.camera.x,-s.camera.y),Te();const e=[...p.map(l=>({...l,drawType:"scenery",z:l.y})),...G.map(l=>({...l,drawType:"fence",z:l.y+10})),...w.map(l=>({...l,drawType:"zone",z:l.y+l.collisionBox.h+l.collisionBox.y})),...u.map(l=>({...l,drawType:"animal",z:l.y+2})),{drawType:"player",z:s.player.y+s.player.h}];if(e.sort((l,i)=>l.z-i.z),e.forEach(l=>{l.drawType==="scenery"&&Z(l),l.drawType==="fence"&&Ee(l),l.drawType==="zone"&&Le(l),l.drawType==="animal"&&W(l),l.drawType==="player"&&Pe()}),s.interactionTarget){const l=s.interactionTarget,i=l.x+l.door.x,o=l.y+l.door.y-30;t.fillStyle="white",t.strokeStyle="black",t.lineWidth=2;const n=Math.sin(Date.now()/200)*5;t.beginPath(),t.moveTo(i-10,o+n),t.lineTo(i+10,o+n),t.lineTo(i,o+10+n),t.closePath(),t.fill(),t.stroke()}if(s.editor.active&&s.editor.tool!=="erase"){const l=s.editor.mouseX+s.camera.x,i=s.editor.mouseY+s.camera.y;t.globalAlpha=.5,["cow","chicken","horse","sheep"].includes(s.editor.tool)?W({x:l,y:i,type:s.editor.tool,isMoving:!1,frame:0}):Z({x:l,y:i,type:s.editor.tool}),t.globalAlpha=1,t.strokeStyle="white",t.lineWidth=2,t.beginPath(),t.arc(l,i,20,0,Math.PI*2),t.stroke()}else if(s.editor.active&&s.editor.tool==="erase"){const l=s.editor.mouseX+s.camera.x,i=s.editor.mouseY+s.camera.y;t.strokeStyle="red",t.lineWidth=2,t.beginPath(),t.arc(l,i,15,0,Math.PI*2),t.moveTo(l-10,i-10),t.lineTo(l+10,i+10),t.moveTo(l+10,i-10),t.lineTo(l-10,i+10),t.stroke()}s.debug.showCoords&&Me(),t.restore()}function Me(){t.save(),t.lineWidth=1,t.font="10px monospace",t.strokeStyle="rgba(255, 0, 0, 0.5)",t.beginPath(),t.moveTo(c.minX,0),t.lineTo(c.maxX,0),t.stroke(),t.strokeStyle="rgba(0, 0, 255, 0.5)",t.beginPath(),t.moveTo(0,c.minY),t.lineTo(0,c.maxY),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.7)",t.textAlign="center",t.textBaseline="top";for(let e=Math.ceil(c.minX/100)*100;e<=c.maxX;e+=100)e!==0&&(t.beginPath(),t.moveTo(e,-5),t.lineTo(e,5),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.stroke(),t.fillText(e.toString(),e,8));t.textAlign="left",t.textBaseline="middle";for(let e=Math.ceil(c.minY/100)*100;e<=c.maxY;e+=100)e!==0&&(t.beginPath(),t.moveTo(-5,e),t.lineTo(5,e),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.stroke(),t.fillText(e.toString(),8,e));t.fillStyle="yellow",t.fillText("(0,0)",5,5),t.restore()}function Te(){t.fillStyle=d.water,t.fillRect(s.camera.x,s.camera.y,h.width,h.height);const e=Date.now();t.fillStyle="rgba(255, 255, 255, 0.4)";const l=Math.floor(s.camera.x/50)*50,i=Math.floor(s.camera.y/50)*50,o=h.width+100,n=h.height+100;for(let a=l;a<l+o;a+=50)for(let r=i;r<i+n;r+=50){const y=Math.sin(a*99+e/1e3)*20,f=Math.cos(r*88+e/1e3)*20;if(a+y<c.minX||a+y>c.maxX||r+f<c.minY||r+f>c.maxY){const b=(Math.sin(e/500+a)+1)*2+1;t.fillRect(a+y,r+f,b*2,b)}}t.fillStyle=d.grass,t.fillRect(c.minX,c.minY,c.maxX-c.minX,c.maxY-c.minY),t.fillStyle=d.grassDark;for(let a=c.minX;a<c.maxX;a+=50)for(let r=c.minY;r<c.maxY;r+=50)Math.abs(a*r)%7===0&&(t.fillRect(a+10,r+10,5,5),t.fillRect(a+15,r+5,5,5))}function Ee(e){t.fillStyle=d.woodDark,t.fillRect(e.x,e.y-15,8,20),t.fillStyle=d.wood,t.fillRect(e.x-10,e.y-10,42,4),t.fillRect(e.x-10,e.y-2,42,4)}function Z(e){e.type==="tree"?(t.fillStyle=d.woodDark,t.fillRect(e.x-8,e.y-10,16,30),t.fillStyle=d.treeLight,t.beginPath(),t.arc(e.x,e.y-30,25,0,Math.PI*2),t.fill(),t.fillStyle=d.treeDark,t.beginPath(),t.arc(e.x-10,e.y-35,15,0,Math.PI*2),t.fill()):e.type==="rock"?(t.fillStyle="#7f8c8d",t.beginPath(),t.arc(e.x,e.y,10,0,Math.PI*2),t.fill(),t.fillStyle="#95a5a6",t.fillRect(e.x-5,e.y-8,5,5)):e.type==="flower"?(t.fillStyle=d.flowerStem,t.fillRect(e.x-1,e.y,2,8),t.fillStyle=d.flowerPetal,t.beginPath(),t.arc(e.x,e.y,4,0,Math.PI*2),t.fill(),t.fillStyle="#f1c40f",t.beginPath(),t.arc(e.x,e.y,1.5,0,Math.PI*2),t.fill()):e.type==="plant"&&(t.fillStyle=d.cropLeaf,t.beginPath(),t.arc(e.x,e.y-4,6,0,Math.PI*2),t.fill(),t.fillStyle=d.cropFruit[0],t.beginPath(),t.arc(e.x,e.y-8,3,0,Math.PI*2),t.fill())}function W(e){const l=e.x,i=e.y,o=q[e.type],n=e.isMoving&&Math.floor(e.frame)===1?2:0;t.save();let a=!1;e.type==="chicken"?e.facing==="left"&&(a=!0):e.facing==="right"&&(a=!0),a&&(t.translate(l,i),t.scale(-1,1),t.translate(-l,-i)),t.fillStyle="rgba(0,0,0,0.2)",t.beginPath(),t.ellipse(l,i+4,10,5,0,0,Math.PI*2),t.fill(),e.type==="cow"?(t.fillStyle=o.body,t.fillRect(l-14,i-20,28,20),t.fillStyle=o.spots,t.fillRect(l-8,i-18,10,8),t.fillRect(l+6,i-14,6,6),t.fillStyle=o.body,t.fillRect(l-18,i-26,16,16),t.fillStyle="#d7ccc8",t.fillRect(l-18,i-28,4,4),t.fillRect(l-6,i-28,4,4),t.fillStyle=o.body,t.fillRect(l-20,i-22,2,4),t.fillRect(l-2,i-22,2,4),t.fillStyle=o.snout,t.fillRect(l-18,i-14,16,6),t.fillStyle="#000",t.fillRect(l-16,i-20,2,2),t.fillRect(l-8,i-20,2,2),t.fillStyle=o.body,t.fillRect(l-12,i,6,6+n),t.fillRect(l+6,i,6,6-n),t.fillStyle=o.body,t.fillRect(l+14,i-18,2,10),t.fillStyle=o.spots,t.fillRect(l+13,i-8,4,4)):e.type==="chicken"?(t.fillStyle=o.body,t.fillRect(l-6,i-10,12,10),t.fillStyle=o.body,t.fillRect(l-8,i-12,4,6),t.fillStyle="#e0e0e0",t.fillRect(l-2,i-8,6,4),t.fillStyle=o.body,t.fillRect(l+2,i-14,6,6),t.fillStyle=o.comb,t.fillRect(l+3,i-16,4,2),t.fillRect(l+4,i-10,2,2),t.fillStyle=o.beak,t.fillRect(l+8,i-12,2,2),t.fillStyle="#000",t.fillRect(l+6,i-13,1,1),t.fillStyle="#e67e22",t.fillRect(l-2,i,2,4+n),t.fillRect(l+4,i,2,4-n)):e.type==="horse"?(t.fillStyle=o.body,t.fillRect(l-14,i-22,30,18),t.fillStyle=o.body,t.fillRect(l-16,i-30,10,14),t.fillStyle=o.body,t.fillRect(l-22,i-32,14,10),t.fillStyle=o.mane,t.fillRect(l-6,i-32,4,16),t.fillRect(l-16,i-34,4,4),t.fillStyle=o.body,t.fillRect(l-14,i-34,2,4),t.fillRect(l-8,i-34,2,4),t.fillStyle=o.snout,t.fillRect(l-24,i-28,4,6),t.fillStyle="#000",t.fillRect(l-18,i-28,2,2),t.fillStyle=o.body,t.fillRect(l-12,i-4,6,10+n),t.fillRect(l+8,i-4,6,10-n),t.fillStyle=o.mane,t.fillRect(l+16,i-20,4,12)):e.type==="sheep"&&(t.fillStyle=o.legs,t.fillRect(l-8,i+2,4,6+n),t.fillRect(l+4,i+2,4,6-n),t.fillStyle=o.body,t.beginPath(),t.arc(l,i-8,10,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(l-6,i-6,8,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(l+6,i-6,8,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(l,i-12,9,0,Math.PI*2),t.fill(),t.fillStyle=o.head,t.fillRect(l-14,i-16,10,10),t.fillRect(l-16,i-14,2,4),t.fillRect(l-4,i-14,2,4),t.fillStyle=o.body,t.fillRect(l-14,i-18,10,4),t.fillStyle="#fff",t.fillRect(l-12,i-14,2,2)),t.restore()}function Le(e){if(e.type==="building")t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(e.x+10,e.y+100,140,40),t.fillStyle="#f5d76e",t.fillRect(e.x+10,e.y+40,140,90),t.fillStyle=d.wood,t.fillRect(e.x+10,e.y+40,140,10),t.fillRect(e.x+10,e.y+120,140,10),t.fillRect(e.x+10,e.y+40,10,90),t.fillRect(e.x+140,e.y+40,10,90),t.fillStyle=d.roof,t.beginPath(),t.moveTo(e.x-10,e.y+40),t.lineTo(e.x+80,e.y-20),t.lineTo(e.x+170,e.y+40),t.fill(),t.fillStyle=d.woodDark,t.fillRect(e.x+60,e.y+80,40,50),t.fillStyle="#f39c12",t.fillRect(e.x+90,e.y+105,4,4),t.fillStyle="#85c1e9",t.fillRect(e.x+25,e.y+60,30,30),t.fillStyle=d.wood,t.fillRect(e.x+38,e.y+60,4,30),t.fillRect(e.x+25,e.y+73,30,4);else if(e.type==="garden"){t.fillStyle=d.dirt,t.fillRect(e.x,e.y,e.w,e.h),t.strokeStyle="rgba(0,0,0,0.1)",t.beginPath();for(let l=0;l<=e.w;l+=30)t.moveTo(e.x+l,e.y),t.lineTo(e.x+l,e.y+e.h);for(let l=0;l<=e.h;l+=30)t.moveTo(e.x,e.y+l),t.lineTo(e.x+e.w,e.y+l);t.stroke();for(let l=15;l<e.w;l+=30)for(let i=15;i<e.h;i+=30){t.fillStyle=d.cropLeaf,t.beginPath(),t.arc(e.x+l,e.y+i,10,0,Math.PI*2),t.fill();const o=d.cropFruit,n=o[(l+i)%o.length];t.fillStyle=n,t.beginPath(),t.arc(e.x+l,e.y+i-5,4,0,Math.PI*2),t.fill()}}else e.type==="sign"?(t.fillStyle=d.wood,t.fillRect(e.x+15,e.y+30,5,20),t.fillRect(e.x+60,e.y+30,5,20),t.fillStyle=d.woodDark,t.fillRect(e.x,e.y,e.w,40),t.fillStyle="#fff",t.fillRect(e.x+5,e.y+5,e.w-10,30),t.fillStyle="#333",t.fillRect(e.x+10,e.y+15,e.w-20,2),t.fillRect(e.x+10,e.y+25,e.w-20,2)):e.type==="mailbox"&&(t.fillStyle="#bdc3c7",t.fillRect(e.x+12,e.y+20,6,30),t.fillStyle="#34495e",t.beginPath(),t.arc(e.x+15,e.y+10,15,Math.PI,0),t.lineTo(e.x+30,e.y+20),t.lineTo(e.x,e.y+20),t.fill(),t.fillStyle="#c0392b",t.fillRect(e.x+28,e.y+5,2,10),t.fillRect(e.x+28,e.y+5,8,5))}function Pe(){const e=s.player,l=e.x,i=e.y;if(t.fillStyle="rgba(0,0,0,0.3)",t.beginPath(),t.ellipse(l+16,i+30,10,4,0,0,Math.PI*2),t.fill(),t.fillStyle="#2c3e50",e.isMoving){const o=Math.sin(Date.now()/100)*5;t.fillRect(l+8,i+20+o,6,12),t.fillRect(l+18,i+20-o,6,12)}else t.fillRect(l+8,i+20,6,12),t.fillRect(l+18,i+20,6,12);t.fillStyle="#e74c3c",t.fillRect(l+6,i+12,20,14),t.fillStyle="#f1c40f",t.fillRect(l+8,i,16,14),t.fillStyle="#2980b9",t.fillRect(l+6,i-4,20,6),t.fillRect(l+8,i-8,16,6),t.fillStyle="black",e.dir==="down"?(t.fillRect(l+12,i+6,2,2),t.fillRect(l+18,i+6,2,2)):e.dir==="right"?t.fillRect(l+18,i+6,2,2):e.dir==="left"&&t.fillRect(l+12,i+6,2,2),t.fillStyle="white",t.font='10px "Press Start 2P"',t.fillText("Me",l+6,i-15)}function ne(e){const l=e-s.lastTime;s.lastTime=e,ke(l),ve(),requestAnimationFrame(ne)}Re();
